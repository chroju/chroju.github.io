<!DOCTYPE html>

<html lang="ja">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no" />

    <title>EKS 学び始めに使った資料のまとめ | the world as code</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://chroju.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://chroju.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://chroju.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://chroju.github.io/manifest.json">
    <link rel="mask-icon" href="https://chroju.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://chroju.github.io/css/main.min.2545a1910010e26a9905276045afab868f812580a1e7482423da6c0c8c214d18.css" />

    
    
    
    
    
    <link rel="stylesheet" href="https://chroju.github.io/css/override.css?t=2020-10-06%2008%3a11%3a18.528697877%20%2b0000%20UTC%20m%3d%2b0.196063783">
    

    
    

    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-6765151-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="https://chroju.github.io/">the world as code</a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://chroju.github.io/archives">Archive</a>
  
    <a class="color-link nav-link" href="https://chroju.github.io/about">About</a>
  
  <a class="color-link nav-link" href="https://chroju.github.io/atom.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="chroju" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chroju" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://chroju.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">EKS 学び始めに使った資料のまとめ</h1>
    
    <time>March 1, 2020</time>
    
    <div>
        <p>
        <p>EKS を今年はじめぐらいから調べて使い始めているのだが、それにあたって参考にした資料群を一度まとめておく。</p>
<h2 id="eks-">EKS 全体</h2>
<ul>
<li><a href="https://eksworkshop.com/">Amazon EKS Workshop :: Amazon EKS Workshop</a></li>
<li><a href="https://speakerdeck.com/mumoshu/eksbesutopurakuteisu2019-dot-2-number-jawsdays">Kubernetes on AWS/EKSベストプラクティス2019.2 #jawsdays - Speaker Deck</a></li>
</ul>
<p>AWS がオフィシャルで提供する Workshop がハンズオンしながら学べてわかりやすい。ドキュメントを脇に携えつつ、まずはこれの「Beginner」にあるコンテンツを全部通すといい感じになれる。「Intermediate」「Advanced」の内容は人によって要不要が分かれるので、各項で何が学べるのか調べつつ、不要であれば飛ばしてもいいかもしれない。</p>
<p>2つ目に挙げている mumoshu 氏の資料が情報量多くてすごい。EKS を使う上で考えなくてはならない点がかなり網羅されている。この資料を読んで、「何言ってるかわからない」と感じるページが無くなるように学習を進めたりしていた。ただし1年前のものなので、一部内容が古くなっている点は注意。</p>
<h2 id="eks-on-fargate">EKS on Fargate</h2>
<ul>
<li><a href="https://qiita.com/mumoshu/items/c9dea2d82a402b4f9c31">入門 EKS on Fargate - Qiita</a></li>
<li><a href="https://blog.inductor.me/entry/eks-for-fargate">EKS for Fargateが出たので社内でファーストインプレッションの情報シェア会をやりました - inductor's blog</a></li>
<li><a href="https://amsy810.hateblo.jp/entry/2019/12/04/151642">EKS on Fargate：virtual-kubelet の違い + Network/LB 周りの調査 - @amsy810's Blog</a></li>
</ul>
<p>ちょうど Fargate が EKS 対応してすぐの時期にあたり、 Fargate を採用するべきか、採用するのであればどのような場面で採用するべきかを考えた。 Fargate って Fargate 以前の EKS と比べてどうなの？という点については前者2つの URL が参考になった。最後のエントリーは Fargate とは何者なのか？ということを知る上で勉強になるのだが、まだ半分ぐらい理解できていない自覚がある。</p>
<h2 id="eks--1">EKS 特有の観点</h2>
<p>Kubernetes ではなく、 EKS にしか存在しない特有の観点というものがいくつかある。</p>
<h3 id="iam-roles-for-service-accounts-irsa">IAM Roles for Service Accounts (IRSA)</h3>
<ul>
<li><a href="https://aws.amazon.com/jp/blogs/news/introducing-fine-grained-iam-roles-service-accounts/">Kubernetes サービスアカウントに対するきめ細やかな IAM ロール割り当ての紹介 | Amazon Web Services ブログ</a></li>
<li><a href="https://onsd.hatenablog.com/entry/2019/09/21/015522">IAM Roles for Service Accounts を　Terraformで手軽に体験してみる - onsd’s blog</a></li>
</ul>
<p>Kubernetes の権限管理の仕組みである Service Accounts と、 AWS の権限管理サービスである IAM を連携した仕組みが IRSA 。導入が2019年9月と比較的最近であり、資料はまだ少なめな印象がある。また IRSA 登場以前に書かれたエントリーでは、 kube2iam など別のソリューションがベストとされていることもあり、注意したい。現時点では IRSA を基本的には使えばいいと捉えている。</p>
<h3 id="amazon-vpc-cni-plugin">Amazon VPC CNI Plugin</h3>
<ul>
<li><a href="https://docs.aws.amazon.com/ja_jp/eks/latest/userguide/pod-networking.html">ポッドネットワーキング (CNI) - Amazon EKS</a></li>
<li><a href="https://github.com/aws/amazon-vpc-cni-k8s">aws/amazon-vpc-cni-k8s: Networking plugin repository for pod networking in Kubernetes using Elastic Network Interfaces on AWS</a></li>
<li><a href="https://docs.aws.amazon.com/ja_jp/eks/latest/userguide/cni-upgrades.html">Amazon VPC CNI Plugin for Kubernetes のアップグレード - Amazon EKS</a></li>
</ul>
<p>EKS には CNI として VPC と連携するためのものがデフォルトインストールされている。あまりこれに特化して解説した資料が見つからなかったのでひたすら公式を読んでいる。 <a href="https://docs.projectcalico.org/introduction/">Calico</a> の導入方法にも触れられている。</p>
<h3 id="kubectl">kubectl</h3>
<ul>
<li><a href="https://dev.classmethod.jp/cloud/aws/eks-update-get-token-cmd/">[アップデート]EKSを使う際にaws-iam-authenticatorが不要になりました! ｜ Developers.IO</a></li>
</ul>
<p>これも2019年5月と比較的最近のリリースで、 aws-iam-authenticator を勧めるのはすでに old な方法になっている。現状は <code>aws eks update-kubeconfig</code> を打つだけで <code>~/.kube/config</code> が更新されて kubectl が使えるようになる。シンプルで好き。</p>
<h3 id="heading">監視</h3>
<ul>
<li><a href="https://www.datadoghq.com/ja/blog/eks-monitoring-datadog/">Monitoring your EKS cluster with Datadog | Datadog</a></li>
<li><a href="https://www.datadoghq.com/ja/blog/eks-cluster-metrics/">Key metrics for Amazon EKS monitoring | Datadog</a></li>
</ul>
<p>EKS 特有の監視方法やプラクティスは Datadog blog を参考とした。 Datadog はこれに限らず、システム監視について体系的にまとまった記事を量産していていつもお世話になっている。</p>
<p>Kubernetes 自体の監視については <a href="https://blog.manabusakai.com/2019/08/monitoring-kubernetes/">我々は Kubernetes の何を監視すればいいのか？ | はったりエンジニアの備忘録</a> を読んだりしたが、まだはっきり答えが出せていない。調べているとよく名前を見かける <a href="https://github.com/kubernetes-retired/heapster#heapster">kubernetes-retired/heapster</a> がすでに Deprecated になっていたり、変化も激しい。</p>
<h2 id="kubernetes-">Kubernetes 全般</h2>
<h3 id="google-cloud-blog">Google Cloud Blog</h3>
<ul>
<li><a href="https://cloud.google.com/blog/ja/products/gcp/5-principles-for-cloud-native-architecture-what-it-is-and-how-to-master-it">クラウドネイティブ アーキテクチャ、5 つの原則 | Google Cloud Blog</a></li>
<li><a href="https://cloud.google.com/blog/products/gcp/kubernetes-best-practices-mapping-external-services">Kubernetes best practices: mapping external services | Google Cloud Blog</a></li>
<li><a href="https://cloud.google.com/blog/products/gcp/kubernetes-best-practices-organizing-with-namespaces">Kubernetes best practices: Organizing with Namespaces | Google Cloud Blog</a></li>
</ul>
<p>Kubernetes 自体のプラクティスについては、やはり Google のほうが豊富に資料を用意している。特に <a href="https://cloud.google.com/blog/topics/kubernetes-best-practices">Kubernets best practices</a> の各記事は一読しておいて損はなさそう。どう使えばいいのか迷ったらここを読む感じにしていた。</p>
<h3 id="heading-1">書籍</h3>
<ul>
<li><a href="https://learning.oreilly.com/library/view/cloud-native-devops/9781492040750/">Cloud Native DevOps with Kubernetes</a></li>
<li><a href="https://learning.oreilly.com/library/view/kubernetes-best-practices/9781492056461/">Kubernetes Best Practices</a></li>
<li><a href="https://learning.oreilly.com/library/view/kubernetes-in-action/9781617293726/">Kubernetes in Action</a></li>
<li><a href="https://learning.oreilly.com/library/view/kubernetes-up-and/9781492046523/">Kubernetes: Up and Running, 2nd Edition</a></li>
</ul>
<p>いずれも <a href="https://www.oreilly.com/online-learning/">O'Reilly online learning</a> で読んでいる。全部通読したわけではなくて、何か調べたいことがあったときに逐次辞書のように引いている。特に1番目の『Cloud Native 〜』は Kubernetes の初歩から始まり、 Kubernetes cluster をどのように運用していくのか、カオスエンジニアリングやシークレット管理の話、デプロイまわりなどかなり幅広くまとまっていておすすめ。1つのベンダーにとらわれることなく、各種 OSS や SaaS に少しずつ触れているので、cluster 運用に活用するツールの比較検討を進める端緒として使いやすい。最近日本語版も出ている。</p>
<div class="iframely-embed"><div class="iframely-responsive" style="height: 140px; padding-bottom: 0;"><a href="https://www.oreilly.co.jp//books/9784873119014/" data-iframely-url="//cdn.iframe.ly/0P3neqA"></a></div></div><script async src="//cdn.iframe.ly/embed.js" charset="utf-8"></script>
<p>あとデプロイ（CI/CD）まわりもいろいろ読んだと思うのだけど、どれを読んだかちょっと思い出せなくなってしまった。</p>

        </p>
    </div>
    

    <div class="page-footer">
        
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="chroju" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chroju" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://chroju.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>