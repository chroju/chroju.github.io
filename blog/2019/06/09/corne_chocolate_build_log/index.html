<!DOCTYPE html>

<html lang="ja">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no" />

    <title>Corne Chocolate を組み立てる、40%キーボードに目覚める | the world as code</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="https://chroju.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://chroju.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://chroju.github.io/favicon-16x16.png">
    <link rel="manifest" href="https://chroju.github.io/manifest.json">
    <link rel="mask-icon" href="https://chroju.github.io/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://chroju.github.io/css/main.min.2545a1910010e26a9905276045afab868f812580a1e7482423da6c0c8c214d18.css" />

    
    
    
    
    
    <link rel="stylesheet" href="https://chroju.github.io/css/override.css?t=2020-11-21%2006%3a48%3a23.74755809%20%2b0000%20UTC%20m%3d%2b0.342598415">
    

    
    

    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-6765151-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="https://chroju.github.io/">the world as code</a>
    </div>  
</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="https://chroju.github.io/archives">Archive</a>
  
    <a class="color-link nav-link" href="https://chroju.github.io/about">About</a>
  
  <a class="color-link nav-link" href="https://chroju.github.io/atom.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="chroju" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chroju" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://chroju.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">Corne Chocolate を組み立てる、40%キーボードに目覚める</h1>
    
    <time>June 9, 2019</time>
    
    <div>
        <p>
        <p><a href="https://gyazo.com/a1907073d1c0e66e41ef19e5c755151a"><img src="https://i.gyazo.com/a1907073d1c0e66e41ef19e5c755151a.jpg" alt="Image from Gyazo" width="600"/></a></p>
<p>前回の記事で書いたとおり Corne Chocolate を買って、無事に組み立てが完了した。</p>
<h2 id="corne-chocolate">Corne Chocolate</h2>
<p><a href="https://yushakobo.jp/shop/corne-chocolate/">Corne Chocolate</a> は <a href="https://twitter.com/foostan?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor">foostan</a> 氏が設計、販売している自作キーボード。</p>
<ul>
<li>分割型</li>
<li>42キーのいわゆる40%キーボード</li>
<li>Cherry MX 対応と Kailh Choc (Low Profile) 対応の2バージョン、それぞれホットスワップ</li>
<li>オプションでフルカラー LED 実装可能</li>
</ul>
<p>といった特徴がある。私がこれを買ったのは Lily58 Pro を使うなかで数字列が要らないのではないか、つまり40%キーボードで良いのではないかと悟ったからであり、40%の分割型で Kailh Choc 対応という3つの希望を満たしてくれるのがこれだった。ちなみに Cherry MX 対応のほうは Corne Cherry と呼ばれる。略して crkbd と表記されることもあるみたい。</p>
<h2 id="heading">購入、組み立て</h2>
<p>Lily58 Pro と同じく遊舎工房さんの実店舗で購入して組み立てた。組み立ては Lily58 Pro とわりと似ているというか、ダイオードが表面実装タイプで、キーソケットも同じ Kailh Choc のスワップタイプのものだったので、はんだ付けの工程はまったく同じで手間取ることがなかった。最初に使えるようになるまでは5時間ぐらい。</p>
<p><a href="https://gyazo.com/37817309abaa100339c1eecb4c4be121"><img src="https://i.gyazo.com/37817309abaa100339c1eecb4c4be121.jpg" alt="Image from Gyazo" width="400"/></a></p>
<p>大変だったのは LED 。 Corne に関して他の方のビルドログを探ってみても、一様に LED のはんだ付けが難しいという話が出てくるが、確かに難しかった。LED は PCB 基板の裏側からはんだ付けする必要があるのだけど、裏側にそのまま表面実装ではんだ付けする Underglow 用のものと、基板に空いた穴に LED をはめ込んではんだ付けする Backlight 用のものとの2種類がある。難しいと言われるのは Underglow 用のものの方みたいなんだけど、はんだ付け初級者としてはどちらも難しかった。</p>
<h3 id="backlight-led">Backlight LED</h3>
<p>写真でわかりづらいかもしれないが、 Backlight LED はこのように穴のなかにはめこんで、基板側のランドと繋ぐ必要がある。</p>
<p><a href="https://gyazo.com/f642119bfce092e5c3ee07fd66740ca3"><img src="https://i.gyazo.com/f642119bfce092e5c3ee07fd66740ca3.jpg" alt="Image from Gyazo" width="400"/></a></p>
<p>ただ、基板のランドと LED とが平らに並ぶ（「ツライチ」と呼ぶらしい）わけではなく、少し段差があって、その間をうまくはんだでブリッジさせることが難しかった。ただ、上手くいかなければ一度はんだ吸い取り線で一度はがしてやり直せるので、確かに Underglow よりは楽だと思う。</p>
<h3 id="underglow-led">Underglow LED</h3>
<p>表面実装なので、何も考えずランドに予備はんだを盛ってから取り付ける方式でやってみたんだけど、それだと LED が浮いてしまってうまくいかず、一度外してやり直そうと思っても LED の裏側にまではんだが入り込んでしまっているので外せなくて終いにはランドを剥がしてしまった。</p>
<p><a href="https://gyazo.com/e1f2cce60faa3d27ab881c4638cb0e8a"><img src="https://i.gyazo.com/e1f2cce60faa3d27ab881c4638cb0e8a.jpg" alt="Image from Gyazo" width="400"/></a></p>
<p>その後いろいろと調べてみたところ、 <a href="http://nok0714.hatenablog.com/entry/2019/03/02/194138">Corne Chocolateビルドログ - nokの雑記</a> に図解されているように、予備はんだを盛るのではなくて、 LED を先に基板に置いてしまって、端子部分に横からはんだを差し入れるようにするのが良いらしいとわかった。その後気づいたけれど、これは Corne Chocolate ではなくて、前バージョンにあたる <a href="https://github.com/foostan/crkbd/blob/master/corne-classic/doc/buildguide_jp.md">Corne Classic のビルドガイド</a> にも載っている方法だった。</p>
<p>幸いにも遊舎工房さんで Corne の PCB 単体での販売があったので、それで1枚追加で購入して改めてやり直した。やり方を変えてそれなりにスムーズに実装できるようになったが、この方法はちゃんとはんだが盛れているか目視では確認しづらくて、頻繁に通電してちゃんと光るか確認しながら進めた。ビルドガイドにもある通り、 LED はすべて接続されていて、1つがダメだとその先のものがすべて光らなくなるので、番号順に実装を進めていった。わからなかったのが、光らない LED があるものの、その先の LED は光っており、しかし色がおかしい、という事態。これがどうにも克服できなかった。電気的な部分はまったくわからないなりに <a href="https://marksard.github.io/2018/08/04/make-the-crkbd/">コルネキーボードを作りました ～LED取り付けに四苦八苦記～ | キオクノロンダリング</a> などを参考に、どの端子がどういう働きをしているかなどを確認してみて、導線で上手いことジャンパすれば直らないかなと四苦八苦した結果、原理はわからないけれど、光らない LED と、その1つ手前の LED の DOUT 同士を繋いでみたところ、光らない LED は光らないままだけど色はちゃんと出るようになった。 Underglow が1つ光らないのは諦めて、いまのところこれで妥協している。</p>
<p><a href="https://gyazo.com/1f366b2b467921be1dd3fa4ae6a21da1"><img src="https://i.gyazo.com/1f366b2b467921be1dd3fa4ae6a21da1.jpg" alt="Image from Gyazo" width="400"/></a></p>
<h2 id="heading-1">キーキャップとキースイッチ</h2>
<p>キースイッチは前回の Lily58 Pro で茶軸を買っていたので、今回は赤軸を買ってみた。軽くサクサク打ててとてもよかったんだけど、小指で押さえるキーや、一定時間押しっぱなしにする修飾キーはタクタイルのクリック感があったほうが押し込みやすかったので、今は以下のようなハイブリッドにしてみている。</p>
<p><a href="https://gyazo.com/a7464fae428d09232d8f6d96257401f5"><img src="https://i.gyazo.com/a7464fae428d09232d8f6d96257401f5.jpg" alt="Image from Gyazo" width="600"/></a></p>
<p>キーキャップは monksoffunk 氏が DMM.make で販売しているものを買ってみた。</p>
<div class="iframely-embed"><div class="iframely-responsive" style="height: 140px; padding-bottom: 0;"><a href="https://make.dmm.com/item/1009205/" data-iframely-url="//cdn.iframe.ly/Ac1er9N"></a></div></div><script async src="//cdn.iframe.ly/embed.js" charset="utf-8"></script>
<p>DMM.make では3Dプリント用のデータをアップロードして出品することができる。ユーザーがそのデータに対して注文をかけると、 DMM で実際にプリントして物品を送ってきてくれる仕組み。3Dプリントされた物品を手に持ったことがないのでどんなものかと思ったけど、手触りはさらさらしているものの程よいざらつきもあって、とても打ち心地のいいキーキャップだった。Kailh Choc 用のキーキャップは、<a href="https://yushakobo.jp/shop/pg1350cap-blank/">遊舎工房にも置かれている Kailh 自身が販売しているもの</a>ぐらいしか出回っていないと思うのだけど、それと比べても見た目、打ち心地ともに上回って満足している。</p>
<p>ちなみにプリントする素材が選べるのだが、PA12GB ブラック磨きを選択している。販売ページの断り書きに「破損の恐れがあるためキャンセルを促される連絡があるかもしれません」とあるけれど、これはこのキーキャップが DMM 側の規定サイズを満たさず、品質保証ができないためのようで、実際に一度は DMM 側から強制的にキャンセルされた。その後サポートから「破損の可能性を受け入れた上で再注文したい」と申し出たところ無事に購入することができ、再注文から9日で到着した。確かに1個だけ軸が折れたものが混ざっていたけれど、キットには予備のキーキャップがいくつか入っているので問題はなかった。</p>
<p><a href="https://gyazo.com/7336dc16b0729f856685ff7ba63b0e74"><img src="https://i.gyazo.com/7336dc16b0729f856685ff7ba63b0e74.jpg" alt="Image from Gyazo" width="400"/></a></p>
<h2 id="heading-2">キーマップ</h2>
<p>まだ適宜変更は入ると思うけど、いまのところ以下のようになっている。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#719e07">const</span> uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] <span style="color:#719e07">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>  [_QWERTY] <span style="color:#719e07">=</span> LAYOUT_kc( \
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>  <span style="color:#586e75">//,-----------------------------------------.                ,-----------------------------------------.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span><span style="color:#586e75"></span>        TAB,     Q,     W,     E,     R,     T,                      Y,     U,     I,     O,     P,  BSLS,\
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>  <span style="color:#586e75">//|------+------+------+------+------+------|                |------+------+------+------+------+------|
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span><span style="color:#586e75"></span>     CTLGUI,     A,     S,     D,     F,     G,                      H,     J,     K,     L,  SCLN,  QUOT,\
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span>  <span style="color:#586e75">//|------+------+------+------+------+------|                |------+------+------+------+------+------|
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span><span style="color:#586e75"></span>     SFTESC,     Z,     X,     C,     V,     B,                      N,     M,  COMM,   DOT,  SLSH,  RALT,\
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>  <span style="color:#586e75">//|------+------+------+------+------+------+------|  |------+------+------+------+------+------+------|
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span><span style="color:#586e75"></span>                                   LGUI, LOWER,SPCALT,      ENT,RASLNG,  BSPC \
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>                              <span style="color:#586e75">//`--------------------&#39;  `--------------------&#39;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span><span style="color:#586e75"></span>  ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>  [_RAISE] <span style="color:#719e07">=</span> LAYOUT_kc( \
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>  <span style="color:#586e75">//,-----------------------------------------.                ,-----------------------------------------.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span><span style="color:#586e75"></span>       LRST,    F1,    F2,    F3,    F4,    F5,                     F6,    F7,    F8,    F9,   F10,   F12,\
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>  <span style="color:#586e75">//|------+------+------+------+------+------|                |------+------+------+------+------+------|
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span><span style="color:#586e75"></span>       LTOG,  LHUI,  LSAI,  LVAI, XXXXX, XXXXX,                   LEFT,  DOWN,    UP, RIGHT,  VOLU,  BRIU,\
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>  <span style="color:#586e75">//|------+------+------+------+------+------|                |------+------+------+------+------+------|
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span><span style="color:#586e75"></span>       LMOD,  LHUD,  LSAD,  LVAD, XXXXX, XXXXX,                  XXXXX, XXXXX, XXXXX,  MUTE,  VOLD,  BRID,\
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>  <span style="color:#586e75">//|------+------+------+------+------+------+------|  |------+------+------+------+------+------+------|
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span><span style="color:#586e75"></span>                                   LGUI, LOWER,SPCALT,      ENT,RASLNG,   CAD \
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span>                              <span style="color:#586e75">//`--------------------&#39;  `--------------------&#39;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span><span style="color:#586e75"></span>  ),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>  [_LOWER] <span style="color:#719e07">=</span> LAYOUT_kc( \
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>  <span style="color:#586e75">//,-----------------------------------------.                ,-----------------------------------------.
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span><span style="color:#586e75"></span>       EXLM,     <span style="color:#2aa198">1</span>,     <span style="color:#2aa198">2</span>,     <span style="color:#2aa198">3</span>,     <span style="color:#2aa198">4</span>,     <span style="color:#2aa198">5</span>,                      <span style="color:#2aa198">6</span>,     <span style="color:#2aa198">7</span>,     <span style="color:#2aa198">8</span>,     <span style="color:#2aa198">9</span>,     <span style="color:#2aa198">0</span>, XXXXX,\
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span>  <span style="color:#586e75">//|------+------+------+------+------+------|                |------+------+------+------+------+------|
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30</span><span style="color:#586e75"></span>       TILD, XXXXX, XXXXX, XXXXX, XXXXX, LCBRS,                  RCBRS,  MINS,   EQL, XXXXX, XXXXX, XXXXX,\
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31</span>  <span style="color:#586e75">//|------+------+------+------+------+------|                |------+------+------+------+------+------|
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32</span><span style="color:#586e75"></span>        GRV,    AT,  HASH,   DLR,  PERC, XXXXX,                   ASTR,  UNDS,  PLUS,  CIRC,  AMPR,  ASTR,\
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33</span>  <span style="color:#586e75">//|------+------+------+------+------+------+------|  |------+------+------+------+------+------+------|
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34</span><span style="color:#586e75"></span>                                   LGUI, LOWER,SPCALT,      ENT,RASLNG,  BSPC \
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35</span>                              <span style="color:#586e75">//`--------------------&#39;  `--------------------&#39;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">36</span><span style="color:#586e75"></span>  )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">37</span>};
</code></pre></div><p>デフォルトでは RAISE と LAWER を同時押しすることで変更できる ADJUST レイヤーも含む4レイヤー用意されているが、3レイヤーでなんとか収まった。LOWER が記号や数字、RAISE がファンクションキーや LED の調整などの操作系のキーという振り分けになっている。</p>
<p>42キーとだいぶキー数が減ったことで、1つのキーに Tap Dance や Mod-Tap によって複数の役割をもたせている箇所も増えている。左側の「SFTESC」や、親指部分の「SPCALT」はいずれも Mod-Tap で同時押ししたときと単推しのときで役割を変えている。また LOWER レイヤーの左右それぞれ一番内側中段にある「LCBRS」「RCBRS」は Tap Dance によって <code>[</code>, <code>(</code>, <code>{</code> の3種類の括弧を切り替えられるようにしたものなんだけど、3回タップするのはわりと手間で、ちょっと今見直そうか迷っている。</p>
<p>渾身のキーが右親指の「RASLNG」。これは長押しすると RAISE、単推しで IME 無効化、2回連続押しで IME 有効化という3種類の役割を担っている。IME の on/off 切り替えは1つのキーでトグルさせるのではなく、別々のキーに割り当てたほうが冪等な操作ができて良い、と私も思っているのだけど、例えば左親指で off で右親指で on のように振り分けるとどちらがどっちだったか覚えるのが煩わしいという問題と、同じ IME 操作をするのに意識が左右に散らばってしまって不快という問題があり、1つのキーを押した回数で冪等に切り替える方式を採用した。 Tap Dance の設定を以下のように書いており、1回押したときに <code>LANG2</code> と <code>F13</code> 、2回押したときに <code>LANG1</code> と <code>F16</code> を発行するようにしている。LANGの各キーコードによる IME の切り替えは macOS にしか対応しないので、 Windows では IME の設定により、ファンクションキーで IME の有効無効を切り替えられるようにした形。</p>
<div class="highlight"><pre style="color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 1</span><span style="color:#719e07">enum</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 2</span>  SINGLE_TAP <span style="color:#719e07">=</span> <span style="color:#2aa198">1</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 3</span>  SINGLE_HOLD <span style="color:#719e07">=</span> <span style="color:#2aa198">2</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 4</span>  DOUBLE_TAP <span style="color:#719e07">=</span> <span style="color:#2aa198">3</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 5</span>};
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 7</span><span style="color:#719e07">typedef</span> <span style="color:#719e07">struct</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 8</span>  <span style="color:#dc322f">bool</span> is_press_action;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050"> 9</span>  <span style="color:#dc322f">int</span> state;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">10</span>} tap;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">11</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">12</span><span style="color:#dc322f">int</span> <span style="color:#268bd2">lang_dance</span> (qk_tap_dance_state_t <span style="color:#719e07">*</span>state) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">13</span>  <span style="color:#719e07">if</span> (state<span style="color:#719e07">-</span><span style="color:#719e07">&gt;</span>count <span style="color:#719e07">=</span><span style="color:#719e07">=</span> <span style="color:#2aa198">1</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">14</span>    <span style="color:#719e07">if</span> (<span style="color:#719e07">!</span>state<span style="color:#719e07">-</span><span style="color:#719e07">&gt;</span>pressed) <span style="color:#719e07">return</span> SINGLE_TAP;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">15</span>    <span style="color:#719e07">else</span> <span style="color:#719e07">return</span> SINGLE_HOLD;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">16</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">17</span>  <span style="color:#719e07">else</span> <span style="color:#719e07">if</span> (state<span style="color:#719e07">-</span><span style="color:#719e07">&gt;</span>count <span style="color:#719e07">=</span><span style="color:#719e07">=</span> <span style="color:#2aa198">2</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">18</span>    <span style="color:#719e07">return</span> DOUBLE_TAP;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">19</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">20</span>  <span style="color:#719e07">else</span> <span style="color:#719e07">return</span> <span style="color:#2aa198">6</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">21</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">22</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">23</span><span style="color:#719e07">static</span> tap xtap_state <span style="color:#719e07">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">24</span>  .is_press_action <span style="color:#719e07">=</span> <span style="color:#b58900">true</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">25</span>  .state <span style="color:#719e07">=</span> <span style="color:#2aa198">0</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">26</span>};
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">27</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">28</span><span style="color:#dc322f">void</span> <span style="color:#268bd2">x_finished_1</span> (qk_tap_dance_state_t <span style="color:#719e07">*</span>state, <span style="color:#dc322f">void</span> <span style="color:#719e07">*</span>user_data) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">29</span>  xtap_state.state <span style="color:#719e07">=</span> lang_dance(state);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">30</span>  <span style="color:#719e07">switch</span> (xtap_state.state) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">31</span>    <span style="color:#719e07">case</span> SINGLE_TAP:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">32</span>        register_code(KC_F13);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">33</span>        register_code(KC_LANG2);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">34</span>        <span style="color:#719e07">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">35</span>    <span style="color:#719e07">case</span> SINGLE_HOLD:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">36</span>        layer_on(_RAISE);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">37</span>        <span style="color:#719e07">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">38</span>    <span style="color:#719e07">case</span> DOUBLE_TAP:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">39</span>        register_code(KC_F16);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">40</span>        register_code(KC_LANG1);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">41</span>        <span style="color:#719e07">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">42</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">43</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">44</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">45</span><span style="color:#dc322f">void</span> <span style="color:#268bd2">x_reset_1</span> (qk_tap_dance_state_t <span style="color:#719e07">*</span>state, <span style="color:#dc322f">void</span> <span style="color:#719e07">*</span>user_data) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">46</span>  <span style="color:#719e07">switch</span> (xtap_state.state) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">47</span>    <span style="color:#719e07">case</span> SINGLE_TAP:  
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">48</span>        unregister_code(KC_F13); 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">49</span>        unregister_code(KC_LANG2);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">50</span>        <span style="color:#719e07">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">51</span>    <span style="color:#719e07">case</span> SINGLE_HOLD: 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">52</span>        layer_off(_RAISE);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">53</span>        <span style="color:#719e07">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">54</span>    <span style="color:#719e07">case</span> DOUBLE_TAP:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">55</span>        unregister_code(KC_F16);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">56</span>        unregister_code(KC_LANG1);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">57</span>        <span style="color:#719e07">break</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">58</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">59</span>  xtap_state.state <span style="color:#719e07">=</span> <span style="color:#2aa198">0</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#495050">60</span>}
</code></pre></div><p>これは自分で思いついたわけではなくて、実装にあたっては以下の記事を大いに参考にさせていただいた。</p>
<ul>
<li><a href="https://qiita.com/miyaoka/items/e3f7242b4767cd599364">変わり種ErgoDox紹介 + IME話 - Qiita</a></li>
<li><a href="https://thomasbaart.nl/2018/12/13/qmk-basics-tap-dance/">QMK Basics: Tap dance, or how to let a key do more with one, two, three – Thomas Baart</a></li>
</ul>
<h2 id="impression">Impression</h2>
<p>記号キーがどこにあるかはまだ全然覚えていないし、特にパスワードを打つときすごく苦労しているけれど、見込んでいたとおり、すべてのキーがホームポジションから1キーだけ離れたところに収まっているというのは無茶苦茶快適で大満足している。早いけれど、とりあえずはこれで End Game と考えていいんじゃないかなぁと感じているぐらい。40%キーボードが実用に足るとは1か月前にはさらさら考えていなかったのが嘘のように「40%でキー数は十分」と思うようになってきている。 LED についても要らないでしょと思っていたし、実用上の意味はまったくないんだけど、実際光ってみるとカッコよく見えてしまい、作り直しまでしてこだわってしまったので、やってみないとわからないことって多いなぁと。</p>
<p>End Game っぽいとは言え、自作キーボード周りの買い物や工作がこれで終わりではなくて、まだ買いたいものもある。<a href="https://keyhive.xyz/shop/aluminum-corne-helidox-case">IMK Corne Case — KeyHive</a> で今アルミ製のケースのグループバイが始まっていて、ちょっと高いけど買おうかなぁと思っている（実際の購入は遊舎工房さんの日本プロキシを用いる予定）。あとせっかくなので Kailh Choc の他のキースイッチも Novelkeys から個人輸入で買ってみようかな、と。はんだ付け工具一式も揃ったんだし、また興味を引かれるキーボードを見かけたら買ってみたい。今回 PCB を追加で買ったときに、足りなくなった部品を買いに秋葉原の秋月電子通商やら西川電子部品やらにも初めて足を踏み入れて、今まで知らなかった領域の知識が増えるのがとても楽しかったし、この経験は今後も活きるといいなと思っている。</p>

        </p>
    </div>
    

    <div class="page-footer">
        
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="chroju" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="chroju" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://chroju.github.io/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>